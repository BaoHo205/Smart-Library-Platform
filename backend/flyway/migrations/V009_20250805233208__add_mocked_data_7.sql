INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '0727c59b-7ec0-4df4-b8fd-c648196e4bd4', '70875304-d60a-467f-8cf8-eb446aad7f5f', '1394174b-5a6e-458a-88c8-4d6656484ff7', '2025-07-25', '2025-08-08', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'd608b963-678c-4f07-af02-6d103df29621', '6b8fe1ec-095b-43e5-8bd6-6760694caccc', '690a70d4-a89b-4ec3-9e8a-e3fbdffd14d1', '2025-07-03', '2025-07-17', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'c4dd6d00-814c-44ab-bf4a-186b3f1f9253', '6b8fe1ec-095b-43e5-8bd6-6760694caccc', 'b42078f9-01d8-4864-888d-dee2d2ae1953', '2025-07-04', '2025-07-18', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '603b4f38-1ee6-4e61-aa88-d5c6f2c5b781', 'e5ed73c9-9e35-4a27-8d8b-cdd00019657b', '4c6887cd-e5c5-4470-8313-9fb48a3ce662', '2025-07-11', '2025-07-25', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '542086af-1003-4552-9296-c288110ccac8', 'e5ed73c9-9e35-4a27-8d8b-cdd00019657b', '4fce7bc0-36b5-4474-a37a-79e2e9e10acf', '2025-06-09', '2025-06-23', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'e16c8a30-e8b2-45c0-8dcb-9c263ee9e874', '9cbf94dd-10df-47c8-abc4-c124791dae74', '9a0baa55-03ce-4cce-adf3-4784e4797a06', '2025-07-26', '2025-08-09', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '41f466a4-6306-4b49-9c11-fc5a43f00ebd', '6b8fe1ec-095b-43e5-8bd6-6760694caccc', '825c0ff5-0599-4127-af19-9a63bfe3c1d5', '2025-06-20', '2025-07-04', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '8ed93ddd-6a23-47c7-a7e7-2722aec2b1dd', 'f7d180d9-dbbe-4bf4-8450-c9141f320826', 'c5304b68-66c0-42c8-a594-431bd2ff252f', '2025-06-26', '2025-07-10', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'c0efbec9-df6a-4870-97cb-c93757b086ca', '70875304-d60a-467f-8cf8-eb446aad7f5f', '8f4d6aec-f46e-4db8-92e8-2f6d564801f9', '2025-06-22', '2025-07-06', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'c78bb3fa-4e6d-4654-a177-c9709b659bf3', '9cbf94dd-10df-47c8-abc4-c124791dae74', '5b857ba9-3b52-46d4-a4bb-b2640a39db2b', '2025-07-01', '2025-07-15', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'f3b70c7d-e941-446b-adf4-f991f2551d4e', 'e5ed73c9-9e35-4a27-8d8b-cdd00019657b', '99321abd-7d13-4c88-a0ae-9de45a7e42d8', '2025-07-16', '2025-07-30', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'd3c16c6d-814a-442b-91dd-4dd888bd8eb5', '9cbf94dd-10df-47c8-abc4-c124791dae74', 'a5b45d98-5439-4450-891a-269fd7dada03', '2025-07-26', '2025-08-09', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'f55c96b7-29c0-4afe-bd05-f483fa4d7458', 'f7d180d9-dbbe-4bf4-8450-c9141f320826', '6d42b5ec-ec57-4c3b-a51f-9f67735d26a9', '2025-06-06', '2025-06-20', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'f086e418-5000-4334-95b2-00717cf56bb9', 'e5ed73c9-9e35-4a27-8d8b-cdd00019657b', '2772b67c-5593-414f-9c3f-ff70668d3f18', '2025-06-16', '2025-06-30', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '97a4cc69-1369-4486-b7e5-b4dc4947354c', 'f7d180d9-dbbe-4bf4-8450-c9141f320826', '0418ba35-d180-4c9c-8cca-b9b41a46e65e', '2025-06-22', '2025-07-06', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'a0ac96d2-337a-46ee-81c6-f6d9dc7d90c6', '9cbf94dd-10df-47c8-abc4-c124791dae74', '52a8e46f-1965-4caa-b4e2-b6db5e9a7174', '2025-07-21', '2025-08-04', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    '2a3a5c10-9a03-43d2-9630-17531493fd4e', '70875304-d60a-467f-8cf8-eb446aad7f5f', '4c8cf7dd-91b1-4304-a06f-7f6e1d3eda53', '2025-06-21', '2025-07-05', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'd1b984bb-bd78-4964-a272-ca55959872d9', '6b8fe1ec-095b-43e5-8bd6-6760694caccc', '61d2f03f-55a6-4768-9ca0-fd717629eaff', '2025-07-24', '2025-08-07', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'cd59e8f8-028c-4be9-959c-e357d14bd62e', '9cbf94dd-10df-47c8-abc4-c124791dae74', 'b1a5e783-cee6-49a6-8939-cc6e017843f6', '2025-06-07', '2025-06-21', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

INSERT INTO checkouts (
    id, userId, bookId, checkoutDate, dueDate, returnDate, isReturned, isLate, createdAt, updatedAt
) VALUES (
    'e22408d8-7ebc-41b3-a3ba-147b007aee54', 'e5ed73c9-9e35-4a27-8d8b-cdd00019657b', '5bb6d3ba-537c-494a-9085-bcfe47f2c245', '2025-07-15', '2025-07-29', NULL, FALSE, FALSE, '2025-08-05 16:29:31.637784', '2025-08-05 16:29:31.637784'
);

-- Update new field - available copies
UPDATE books b
LEFT JOIN (
  SELECT bookId, COUNT(*) AS activeCheckouts
  FROM checkouts
  WHERE isReturned = FALSE
  GROUP BY bookId
) co ON co.bookId = b.id
SET
  b.availableCopies = GREATEST(0, LEAST(b.quantity, b.quantity - IFNULL(co.activeCheckouts, 0))),
  b.status = CASE
               WHEN GREATEST(0, LEAST(b.quantity, b.quantity - IFNULL(co.activeCheckouts, 0))) > 0
                 THEN 'available'
               ELSE 'unavailable'
             END;